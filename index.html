<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>未命名小说-小蓝ccc</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }

        h1 {
            text-align: center;
            color: #444;
            transition: color 0.3s;
        }

        .password-section {
            text-align: center;
            margin-bottom: 30px;
        }

        input[type="password"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
        }

        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .reader-section {
            display: none;
            margin-top: 20px;
        }

        .chapter-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .chapter-content-container {
            position: relative;
            min-height: 300px;
        }

        .chapter-content {
            line-height: 1.6;
            padding: 15px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-height: 300px;
            white-space: pre-line;
            text-indent: 2em;
            transition: background-color 0.3s, color 0.3s;
            visibility: hidden;
            position: absolute;
            z-index: -1;
        }

        .chapter-image {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: block;
            margin: 0 auto;
        }

        .chapter-list {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            transition: background-color 0.3s;
        }

        .chapter-item {
            padding: 5px 0;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        .chapter-item:hover {
            color: #4CAF50;
        }

        .error {
            color: red;
            margin-top: 10px;
        }

        .font-controls {
            margin: 10px 0;
            text-align: center;
        }

        .font-controls select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        /* 夜晚模式样式 */
        body.night-mode {
            background-color: #121212;
            color: #e0e0e0;
        }

        body.night-mode .container {
            background-color: #1e1e1e;
        }

        body.night-mode h1 {
            color: #e0e0e0;
        }

        body.night-mode .chapter-nav {
            background-color: #272727;
        }

        body.night-mode .chapter-content {
            background-color: #272727;
            color: #e0e0e0;
        }

        body.night-mode .chapter-list {
            background-color: #272727;
            border-color: #444;
        }

        body.night-mode .chapter-item {
            border-bottom-color: #444;
        }

        body.night-mode .font-controls select {
            background-color: #333;
            color: #e0e0e0;
            border-color: #555;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>未命名小说-小蓝ccc</h1>

        <div class="password-section" id="passwordSection">
            <h3>输入密钥</h3>
            <input type="password" id="passwordInput" placeholder="输入密码">
            <button onclick="checkPassword()">确认</button>
            <p id="passwordError" class="error"></p>
        </div>

        <div class="reader-section" id="readerSection">
            <h2>小说阅读器</h2>

            <div class="chapter-nav">
                <button id="prevChapter" onclick="prevChapter()">上一章</button>
                <span id="chapterTitle">第一章</span>
                <button id="nextChapter" onclick="nextChapter()">下一章</button>
                <button onclick="toggleNightMode()">夜晚模式</button>
            </div>

            <div class="font-controls">
                <label for="fontSelector">字体选择：</label>
                <select id="fontSelector" onchange="changeFont()">
                    <option value="'Microsoft YaHei', sans-serif">微软雅黑</option>
                    <option value="'SimSun', serif">宋体</option>
                    <option value="'SimHei', sans-serif">黑体</option>
                    <option value="'KaiTi', serif">楷体</option>
                    <option value="'FangSong', serif">仿宋</option>
                    <option value="'Arial', sans-serif">Arial</option>
                    <option value="'Times New Roman', serif">Times New Roman</option>
                </select>
                <label for="fontSize">字号：</label>
                <select id="fontSize" onchange="changeFont()">
                    <option value="14px">小</option>
                    <option value="16px" selected>中</option>
                    <option value="18px">大</option>
                    <option value="20px">特大</option>
                </select>
            </div>

            <div class="chapter-content-container">
                <div class="chapter-content" id="chapterContent">
                    <p>请稍候，正在加载小说内容...</p>
                </div>
                <img id="chapterImage" class="chapter-image" alt="小说内容图片">
            </div>

            <div class="chapter-list" id="chapterList">
                <p>章节列表将在这里显示</p>
            </div>
        </div>
    </div>

    <script>
        // 检测设备类型
        function getDeviceType() {
            const userAgent = navigator.userAgent.toLowerCase();
            if (/iphone|ipad|ipod/.test(userAgent)) {
                return 'apple';
            } else if (/android/.test(userAgent)) {
                return 'android';
            } else {
                return 'computer';
            }
        }

        // 不同设备对应的密码
        const devicePasswords = {
            apple: 'A4c2F-gH6k3-J7Lp8-mN9B5-qE4R7',
            android: 'b3G9P-5tU6S-8yWz2-X1aD4-6HfK9',
            computer: '2E5hI-L3J6M-9nP7Q-rT8sV-4WxZ1'
        };

        // 密码验证
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            const errorElement = document.getElementById('passwordError');
            const deviceType = getDeviceType();
            const correctPassword = devicePasswords[deviceType];

            if (password === correctPassword) {
                document.getElementById('passwordSection').style.display = 'none';
                document.getElementById('readerSection').style.display = 'block';
                loadNovel();
            } else {
                errorElement.textContent = '密码错误，请重试';
            }
        }

        // 小说数据 - 请将您的小说文本粘贴在这里
        const novelContent = `在这里粘贴你的小说内容`;

        let chapters = [];
        let currentChapterIndex = 0;
        let currentFont = "'Microsoft YaHei', sans-serif";
        let currentFontSize = "16px";

        // 加载小说
        function loadNovel() {
            // 分割章节
            const chapterRegex = /第[一二三四五六七八九十百千]+章/g;
            const matches = novelContent.matchAll(chapterRegex);
            let startIndex = 0;
            for (const match of matches) {
                if (startIndex > 0) {
                    chapters.push(novelContent.slice(startIndex, match.index));
                }
                startIndex = match.index;
            }
            chapters.push(novelContent.slice(startIndex));

            // 显示章节列表
            const chapterList = document.getElementById('chapterList');
            chapterList.innerHTML = '';
            chapters.forEach((chapter, index) => {
                const chapterTitle = chapter.match(chapterRegex)[0];
                const chapterItem = document.createElement('div');
                chapterItem.classList.add('chapter-item');
                chapterItem.textContent = chapterTitle;
                chapterItem.addEventListener('click', () => {
                    currentChapterIndex = index;
                    showChapter();
                });
                chapterList.appendChild(chapterItem);
            });

            // 显示第一章
            showChapter();
        }

        // 显示当前章节
        function showChapter() {
            const chapterTitleElement = document.getElementById('chapterTitle');
            const chapterContentElement = document.getElementById('chapterContent');
            const chapter = chapters[currentChapterIndex];
            const chapterTitle = chapter.match(/第[一二三四五六七八九十百千]+章/)[0];
            chapterTitleElement.textContent = chapterTitle;
            const contentStart = chapter.indexOf('\n', chapter.indexOf(chapterTitle) + chapterTitle.length);
            chapterContentElement.innerHTML = chapter.slice(contentStart).trim().replace(/\n/g, '<br>');
            
            // 更新图片
            updateChapterImage();
        }

        // 更新章节图片
        function updateChapterImage() {
            const chapterContent = document.getElementById('chapterContent');
            const chapterImage = document.getElementById('chapterImage');
            
            // 获取容器尺寸
            const container = document.querySelector('.chapter-content-container');
            const width = container.offsetWidth;
            const height = container.offsetHeight;
            
            // 创建canvas
            const canvas = document.createElement('canvas');
            const scale = window.devicePixelRatio || 1;
            canvas.width = width * scale;
            canvas.height = height * scale;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
            
            const context = canvas.getContext('2d');
            context.scale(scale, scale);
            
            // 设置背景和文字样式
            const isNightMode = document.body.classList.contains('night-mode');
            context.fillStyle = isNightMode ? '#272727' : '#fff';
            context.fillRect(0, 0, width, height);
            
            context.font = currentFontSize + ' ' + currentFont;
            context.fillStyle = isNightMode ? '#e0e0e0' : '#333';
            context.textAlign = 'left';
            
            // 计算行高和段落间距
            const lineHeight = parseInt(currentFontSize) * 1.6;
            const paragraphSpacing = parseInt(currentFontSize) * 0.8;
            
            // 获取文本内容并分割段落
            const text = chapterContent.textContent;
            const paragraphs = text.split('\n');
            
            // 绘制文本
            let y = 30; // 起始Y坐标
            const padding = 15;
            const maxWidth = width - padding * 2;
            
            paragraphs.forEach(paragraph => {
                if (paragraph.trim() === '') return;
                
                // 处理段落缩进
                const indentedParagraph = '　　' + paragraph.trim();
                
                // 分割文本行
                const lines = wrapText(context, indentedParagraph, maxWidth);
                
                // 绘制每行文本
                lines.forEach(line => {
                    context.fillText(line, padding, y);
                    y += lineHeight;
                });
                
                y += paragraphSpacing;
            });
            
            // 将canvas转为图片
            chapterImage.src = canvas.toDataURL('image/png');
        }

        // 自动换行函数
        function wrapText(context, text, maxWidth) {
            const words = text.split('');
            const lines = [];
            let currentLine = '';
            
            for (let i = 0; i < words.length; i++) {
                const testLine = currentLine + words[i];
                const metrics = context.measureText(testLine);
                const testWidth = metrics.width;
                
                if (testWidth > maxWidth && i > 0) {
                    lines.push(currentLine);
                    currentLine = words[i];
                } else {
                    currentLine = testLine;
                }
            }
            
            if (currentLine) {
                lines.push(currentLine);
            }
            
            return lines;
        }

        // 上一章
        function prevChapter() {
            if (currentChapterIndex > 0) {
                currentChapterIndex--;
                showChapter();
            }
        }

        // 下一章
        function nextChapter() {
            if (currentChapterIndex < chapters.length - 1) {
                currentChapterIndex++;
                showChapter();
            }
        }

        // 切换夜晚模式
        function toggleNightMode() {
            document.body.classList.toggle('night-mode');
            updateChapterImage();
        }

        // 更改字体
        function changeFont() {
            const fontSelector = document.getElementById('fontSelector');
            const fontSizeSelector = document.getElementById('fontSize');
            currentFont = fontSelector.value;
            currentFontSize = fontSizeSelector.value;
            updateChapterImage();
        }

        // 窗口大小改变时重新生成图片
        window.addEventListener('resize', () => {
            if (chapters.length > 0) {
                updateChapterImage();
            }
        });
    </script>
</body>

</html>
